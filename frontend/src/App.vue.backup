<template>
	<div id="app" :class="appClasses">
		<!-- é¡¶éƒ¨å¯¼èˆªæ  -->
		<header class="app-header bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700">
			<div class="container mx-auto px-4 py-3">
				<div class="flex items-center justify-between">
					<!-- åº”ç”¨æ ‡é¢˜ -->
					<div class="flex items-center space-x-3">
						<h1 class="text-xl font-bold text-gray-900 dark:text-white">
							VocabMemster
						</h1>
						<span class="text-xs bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200 px-2 py-1 rounded">
							v{{ appConfig.version }}
						</span>
					</div>

					<!-- å¯¼èˆªèœå• -->
					<nav class="flex items-center space-x-1">
						<button
							v-for="nav in navigation"
							:key="nav.name"
							@click="switchView(nav.route)"
							:class="[
								'px-4 py-2 rounded-lg text-sm font-medium transition-colors',
								currentView === nav.route
									? 'bg-blue-500 text-white shadow-md'
									: 'text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'
							]"
						>
							{{ nav.name }}
						</button>
					</nav>

					<!-- å³ä¾§æ“ä½œ -->
					<div class="flex items-center space-x-3">
						<!-- ä¸»é¢˜åˆ‡æ¢ -->
						<button
							@click="toggleTheme"
							class="p-2 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
							:title="themeStore.isDarkMode ? 'åˆ‡æ¢åˆ°æµ…è‰²æ¨¡å¼' : 'åˆ‡æ¢åˆ°æ·±è‰²æ¨¡å¼'"
						>
							<span v-if="themeStore.isDarkMode">ğŸŒ™</span>
							<span v-else>â˜€ï¸</span>
						</button>

						<!-- èœå•æŒ‰é’® -->
						<div class="relative">
							<button
								@click="showMenu = !showMenu"
								class="p-2 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
							>
								â‹®
							</button>
							<transition
								enter-active-class="transition duration-100 ease-out"
								enter-from-class="transform scale-95 opacity-0"
								enter-to-class="transform scale-100 opacity-100"
								leave-active-class="transition duration-75 ease-in"
								leave-from-class="transform scale-100 opacity-100"
								leave-to-class="transform scale-95 opacity-0"
							>
								<div
									v-if="showMenu"
									class="absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 py-1 z-50"
								>
									<button
										@click="openFile"
										class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700"
									>
										æ‰“å¼€å•è¯åº“
									</button>
									<button
										@click="resetProgress"
										class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700"
									>
										é‡ç½®è¿›åº¦
									</button>
									<hr class="my-1 border-gray-200 dark:border-gray-600">
									<button
										@click="showUsage"
										class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700"
									>
										ä½¿ç”¨è¯´æ˜
									</button>
									<button
										@click="showAbout"
										class="w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700"
									>
										å…³äº
									</button>
								</div>
							</transition>
						</div>
					</div>
				</div>
			</div>
		</header>

		<!-- ä¸»å†…å®¹åŒºåŸŸ -->
		<main class="app-main flex-1 overflow-auto">
			<router-view />
		</main>

		<!-- å¯¹è¯æ¡†ç³»ç»Ÿ -->
		<DialogSystem />
	</div>
</template>

<script setup>
import { ref, computed, onMounted, onUnmounted } from 'vue'
import { useRouter } from 'vue-router'
import { useThemeStore } from '@stores/theme'
import { useWordStore } from '@stores/word'
import { AppConfig } from '../../settings/app.config.js'
import { bridge } from '@utils/bridge'
import DialogSystem from '@components/DialogSystem.vue'

const router = useRouter()
const themeStore = useThemeStore()
const wordStore = useWordStore()

const appConfig = AppConfig
const currentView = ref('learning')
const showMenu = ref(false)

// å¯¼èˆªèœå•é¡¹
const navigation = [
	{ name: 'å­¦ä¹ ', route: 'learning' },
	{ name: 'å•è¯ç®¡ç†', route: 'word-manager' },
	{ name: 'è®¾ç½®', route: 'settings' }
]

// åº”ç”¨æ ·å¼ç±»
const appClasses = computed(() => ({
	'app-container': true,
	'h-screen': true,
	'flex': true,
	'flex-col': true,
	'dark': themeStore.isDarkMode,
	[`theme-${themeStore.currentTheme}`]: true
}))

// åˆ‡æ¢è§†å›¾
const switchView = (route) => {
	currentView.value = route
	router.push({ name: route })
}

// åˆ‡æ¢ä¸»é¢˜
const toggleTheme = () => {
	themeStore.toggleDarkMode()
}

// æ‰“å¼€æ–‡ä»¶
const openFile = () => {
	// é€šè¿‡åç«¯æ‰“å¼€æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†
	bridge.send('loadWordsFile', {})
	showMenu.value = false
}

// é‡ç½®è¿›åº¦
const resetProgress = () => {
	if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰å­¦ä¹ è¿›åº¦å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')) {
		bridge.send('resetProgress', {})
	}
	showMenu.value = false
}

// æ˜¾ç¤ºä½¿ç”¨è¯´æ˜
const showUsage = () => {
	// å®ç°ä½¿ç”¨è¯´æ˜å¯¹è¯æ¡†
	console.log('æ‰“å¼€ä½¿ç”¨è¯´æ˜')
	showMenu.value = false
}

// æ˜¾ç¤ºå…³äºå¯¹è¯æ¡†
const showAbout = () => {
	// å®ç°å…³äºå¯¹è¯æ¡†
	console.log('æ‰“å¼€å…³äºå¯¹è¯æ¡†')
	showMenu.value = false
}

// é”®ç›˜å¿«æ·é”®
const handleKeyPress = (event) => {
	// Ctrl+Tab - ä¸‹ä¸€ä¸ªå•è¯
	if (event.ctrlKey && event.key === 'Tab') {
		event.preventDefault()
		if (currentView.value === 'learning') {
			wordStore.loadRandomWord()
		}
	}
	// Alt+S - æ˜¾ç¤ºç­”æ¡ˆ
	else if (event.altKey && event.key === 's') {
		event.preventDefault()
		if (currentView.value === 'learning') {
			wordStore.showAnswer()
		}
	}
	// Ctrl+Shift+D - åˆ‡æ¢ä¸»é¢˜
	else if (event.ctrlKey && event.shiftKey && event.key === 'D') {
		event.preventDefault()
		toggleTheme()
	}
}

// ç”Ÿå‘½å‘¨æœŸ
onMounted(() => {
	document.addEventListener('keydown', handleKeyPress)
	// åˆå§‹åŒ–ä¸»é¢˜
	themeStore.initializeTheme()
})

onUnmounted(() => {
	document.removeEventListener('keydown', handleKeyPress)
})
</script>

<style scoped>
.app-container {
	background: var(--app-bg-color);
	color: var(--text-color);
	transition: background-color 0.3s ease, color 0.3s ease;
}

.app-header {
	backdrop-filter: blur(10px);
	position: sticky;
	top: 0;
	z-index: 40;
}

.app-main {
	background: var(--main-bg-color);
}
</style>